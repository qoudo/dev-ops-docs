# Лабораторная работа №2 - Loki + Zabbix + Grafana

## Цель работы

Реализовать систему мониторинга и логирования для тестового сервиса _Nextcloud_ с последующей визуализацией 
данных в _Grafana_.

## Ход работы

### Часть 1. Настройка логирования.

Необходимо разработать комплексную конфигурацию _Docker Compose_, включающую следующие компоненты:

- Nextcloud - основной тестовый сервис;
- Loki - система агрегации логов;
- Promtail - агент сбора логов;
- Grafana - платформа для визуализации данных;
- Zabbix - система мониторинга;
- PostgreSQL - база данных для _Zabbix_.

Результат конфигурации можно посмотреть в файле [docker-compose.yml](docker-compose.yml).

Далее необходимо подготовить конфигурационный файл для Promtail, который будет использоваться в _Docker Compose_. 
Имя файла может быть любым, например `promtail_config.yml`, главное чтобы оно точно соответствовало тому, что указано в 
конфигурации `docker-compose.yml`.

Результат конфигурации можно посмотреть в файле [promtail_config.yml](promtail_config.yml).

Теперь запустим наш docker-compose.yml и убедимся, что сервисы запустились:

```
docker-compose up -d
```

![Изображение](img/1.png)

Открываем адрес localhost:8080 в браузере и регистрируем аккаунт:

![Изображение](img/2.png)
![Изображение](img/3.png)

Проверим, что логи записываются в nextcloud.log:

```
docker exec -it <ID контейнера> bash
cat data/nextcloud.log
```

![Изображение](img/4.png)

После того как _Nextcloud_ настроен, необходимо убедиться, что _Promtail_ корректно отслеживает нужный файл логов.

```
docker logs promtail
```

Найдите записи, содержащие сообщение: `msg=Seeked/opt/nc_data/nextcloud.log`. Если она, то 
_Promtail_ успешно обнаружил указанный файл логов и сервис начал отслеживать изменения в файле.

![Изображение](img/5.png)

### Часть 2. Настройка мониторинга.

